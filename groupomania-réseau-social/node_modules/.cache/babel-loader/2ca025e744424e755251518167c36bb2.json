{"remainingRequest":"/Users/admin/Desktop/P7 Test 2/vue-frontend/node_modules/babel-loader/lib/index.js!/Users/admin/Desktop/P7 Test 2/vue-frontend/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/admin/Desktop/P7 Test 2/vue-frontend/node_modules/vue-loader-v16/dist/index.js??ref--0-1!/Users/admin/Desktop/P7 Test 2/vue-frontend/src/components/Comments.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/admin/Desktop/P7 Test 2/vue-frontend/src/components/Comments.vue","mtime":1631120511000},{"path":"/Users/admin/Desktop/P7 Test 2/vue-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1646670308046},{"path":"/Users/admin/Desktop/P7 Test 2/vue-frontend/node_modules/babel-loader/lib/index.js","mtime":1646670309179},{"path":"/Users/admin/Desktop/P7 Test 2/vue-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1646670308046},{"path":"/Users/admin/Desktop/P7 Test 2/vue-frontend/node_modules/vue-loader-v16/dist/index.js","mtime":1646670309571}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnQ29tbWVudHMnLAogIHByb3BzOiB7CiAgICBjb21tZW50czogQXJyYXksCiAgICBpc0FkbWluOiBCb29sZWFuLAogICAgdXNlcklkOiBOdW1iZXIsCiAgICBwb3N0SWQ6IE51bWJlcgogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG5ld0NvbW1lbnQ6IG51bGwsCiAgICAgIHVwZGF0ZUNvbW1lbnQ6IG51bGwsCiAgICAgIGVkaXRDb21tZW50OiBmYWxzZSwKICAgICAgZXJyTXNnOiBudWxsCiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAgLyogZm9uY3Rpb24gcG91ciBjcsOpZXIgdW4gbm91dmVhdSBjb21tZW50YWlyZSAqLwogICAgY3JlYXRlQ29tbWVudDogZnVuY3Rpb24gY3JlYXRlQ29tbWVudCgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmICghdGhpcy5uZXdDb21tZW50KSB7CiAgICAgICAgdGhpcy5lcnJNc2cgPSAiRXJyZXVyID0+IHZvdXMgZGV2ZXogcmVtcGxpciBsZSBjaGFtcCA8Y29tbWVudGFpcmU+IHBvdXIgY3LDqWVyIHVuIG5vdXZlYXUgY29tbWVudGFpcmUhIjsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBkYXRhID0gewogICAgICAgIHRleHQ6IHRoaXMubmV3Q29tbWVudCwKICAgICAgICB1c2VySWQ6IEpTT04uc3RyaW5naWZ5KHRoaXMudXNlcklkKSwKICAgICAgICBwb3N0SWQ6IEpTT04uc3RyaW5naWZ5KHRoaXMucG9zdElkKQogICAgICB9OwogICAgICBmZXRjaCgiaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9jb21tZW50cy9jcmVhdGUiLCB7CiAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Rva2VuJykpCiAgICAgICAgfSwKICAgICAgICBtb2RlOiAnY29ycycsCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSkKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICByZXR1cm4gX3RoaXMuJGVtaXQoJ2NyZWF0ZWQnLCBkYXRhLmlkKTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgIH0pOwogICAgICB0aGlzLm5ld0NvbW1lbnQgPSAnJzsKICAgIH0sCgogICAgLyogb24gdsOpcmlmaWUgbGUgc3RhdHV0IGRlIGwndXNlciBjb25uZWN0w6kgKi8KICAgIGF1dGg6IGZ1bmN0aW9uIGF1dGgoY29tbWVudFVzZXJJZCkgewogICAgICBpZiAodGhpcy5pc0FkbWluKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnVzZXJJZCAhPT0gY29tbWVudFVzZXJJZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAoKICAgIC8qIHBvdXIgYWZmaWNoZXIvY2FjaGVyIGxhIHNlY3Rpb24gY29tbWVudGFpcmUgZGUgY2UgcG9zdCAqLwogICAgdG9nZ2xlQ29tbWVudDogZnVuY3Rpb24gdG9nZ2xlQ29tbWVudChjb21tZW50SWQsIGNhbmNlbCkgewogICAgICBpZiAoY2FuY2VsKSB7CiAgICAgICAgY29uc29sZS5sb2coImhlbGxvIik7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVkaXRDb21tZW50ID09IGNvbW1lbnRJZCkgewogICAgICAgIGNvbW1lbnRJZCA9IG51bGw7CiAgICAgIH0KCiAgICAgIHRoaXMuZWRpdENvbW1lbnQgPSBjb21tZW50SWQ7CiAgICB9LAoKICAgIC8qIHBvdXIgc3VwcHJpbWVyIGxlIGNvbW1lbnRhaXJlICovCiAgICBkZWxldGVDb21tZW50OiBmdW5jdGlvbiBkZWxldGVDb21tZW50KGNvbW1lbnRJZCkgewogICAgICBpZiAoY29uZmlybSgiw6p0ZXMgdm91cyBzw7tyIGRlIHZvdWxvaXIgc3VwcHJpbWVyIGNlIGNvbW1lbnRhaXJlID8iKSkgewogICAgICAgIGZldGNoKCJodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL2NvbW1lbnRzLyIuY29uY2F0KEpTT04uc3RyaW5naWZ5KGNvbW1lbnRJZCkpLCB7CiAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLAogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0b2tlbicpKQogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgcmV0dXJuIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLiRlbWl0KCdkZWxldGVkJywgY29tbWVudElkKTsKICAgICAgfQogICAgfSwKCiAgICAvKiBwb3VyIG1vZGlmaWVyIGxlIGNvbW1lbnRhaXJlICovCiAgICBtb2RpZnlDb21tZW50OiBmdW5jdGlvbiBtb2RpZnlDb21tZW50KGNvbW1lbnRJZCkgewogICAgICB2YXIgZGF0YSA9IHsKICAgICAgICB0ZXh0OiB0aGlzLiRyZWZzLm1vZGlmeS52YWx1ZQogICAgICB9OwogICAgICBmZXRjaCgiaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9jb21tZW50cy8iLmNvbmNhdChKU09OLnN0cmluZ2lmeShjb21tZW50SWQpKSwgewogICAgICAgIG1ldGhvZDogJ1BVVCcsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndG9rZW4nKSksCiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgICAgfSwKICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICByZXR1cm4gY29uc29sZS5sb2coZXJyb3IpOwogICAgICB9KTsKICAgICAgdGhpcy4kZW1pdCgnbW9kaWZpZWQnLCBjb21tZW50SWQsIGRhdGEudGV4dCk7CiAgICAgIHRoaXMudG9nZ2xlQ29tbWVudChjb21tZW50SWQpOwogICAgfQogIH0sCgogIC8qIG9uIGluZGlxdWUgbGVzIGVtaXR0ZXJzIChpY2kgbCdham91dCBldCBsYSBzdXBwcmVzc2lvbikgKi8KICBlbWl0czogWydjcmVhdGVkJywgJ2RlbGV0ZWQnLCAnbW9kaWZpZWQnXQp9Ow=="},{"version":3,"sources":["/Users/admin/Desktop/P7 Test 2/vue-frontend/src/components/Comments.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <!-- pour créer un nouveau commentaire -->\n    <form @submit.prevent=\"createComment\" v-show=\"!editComment\">\n        <input name=\"comment\" placeholder=\"Publiez un commentaire\" v-model=\"newComment\" class=\"text\">                           \n        <input type=\"submit\" value=\"Je commente!\" class=\"btn\">\n    </form>\n    <p>{{errMsg}}</p>\n    <!-- pour montrer la section commentaire (s'il y en a) -->\n    <div id=\"commentsContainer\" v-show=\"comments.length > 0 \">\n        <div :key=\"comment.id\" v-for=\"comment in comments\" class=\"comment\">\n            <div class=\"header\">\n                <div class=\"profileContainer\">\n                        <img :src=\"'http://localhost:3000/images/' + comment.User.profile\" :alt=\"comment.User.profile\" class=\"profile\">>    \n                </div>\n                <div class=\"commentUsername\">\n                    <h5>{{comment.User.firstname}} {{comment.User.lastname}}</h5>     \n                </div>\n                <div v-if=\"auth(comment.User.id)\" class=\"optionsBtn\">\n                    <button v-if=\"editComment != comment.id\" @click=\"toggleComment(comment.id)\"><i class=\"far fa-edit modify\"></i>modifier</button>\n                    <button v-if=\"editComment == comment.id\" @click=\"toggleComment(comment.id)\"><i class=\"fas fa-arrow-left\"></i>annuler</button>\n                    <button @click=\"deleteComment(comment.id)\"><i class=\"far fa-trash-alt delete\"></i>supprimer</button>    \n                </div>               \n            </div>                       \n            <p v-show=\"!editComment\" class=\"commentText\">{{comment.text}}</p>\n            <!-- pour modifier le commentaire -->\n            <form v-if=\"editComment == comment.id\" @submit.prevent=\"modifyComment(comment.id)\">\n                <input name=\"updateComment\" ref=\"modify\" :value=\"comment.text\" class=\"text\">                           \n                <input type=\"submit\" value=\"Je modifie!\" class=\"btn\">\n            </form>                          \n        </div>        \n    </div>\n</template>\n\n<script>\nexport default {\n    name: 'Comments', \n    props: {\n        comments: Array,\n        isAdmin: Boolean,\n        userId: Number,\n        postId: Number\n    },\n    data() {\n        return {\n            newComment: null,\n            updateComment: null,\n            editComment: false,\n            errMsg: null\n        }\n    },\n    methods: {\n        /* fonction pour créer un nouveau commentaire */\n        createComment() {\n            if (!this.newComment) {\n                this.errMsg = \"Erreur => vous devez remplir le champ <commentaire> pour créer un nouveau commentaire!\"\n                return\n            }\n            const data = {\n                text: this.newComment,\n                userId: JSON.stringify(this.userId),\n                postId: JSON.stringify(this.postId)\n            }\n            fetch(`http://localhost:3000/api/comments/create`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    Authorization: `Bearer ${localStorage.getItem('token')}`\n                },\n                mode: 'cors',\n                body: JSON.stringify(data)\n            })  \n                .then(res => res.json())\n                .then(data => this.$emit('created', data.id))\n                .catch(error => {console.error(error)})\n            this.newComment = ''\n        },\n        /* on vérifie le statut de l'user connecté */\n        auth(commentUserId) {\n            if (this.isAdmin) {\n                return true\n            }\n            if (this.userId !== commentUserId) {\n                return false\n            }\n            return true              \n        },\n        /* pour afficher/cacher la section commentaire de ce post */\n        toggleComment(commentId, cancel) {\n            if (cancel) {\n                console.log(\"hello\")\n            }\n            if (this.editComment == commentId) {\n                commentId = null\n            }\n            this.editComment = commentId\n        },\n        /* pour supprimer le commentaire */\n        deleteComment(commentId) {\n            if (confirm(\"êtes vous sûr de vouloir supprimer ce commentaire ?\")) {\n                fetch(`http://localhost:3000/api/comments/${JSON.stringify(commentId)}`, {\n                    method: 'DELETE',\n                    headers: {\n                        Authorization: `Bearer ${localStorage.getItem('token')}`\n                    } \n                })\n                    .catch(error => console.log(error))\n                this.$emit('deleted', commentId)\n            }   \n        },\n        /* pour modifier le commentaire */ \n        modifyComment(commentId) {        \n            const data = {\n                text: this.$refs.modify.value\n            }\n            fetch(`http://localhost:3000/api/comments/${JSON.stringify(commentId)}`, {\n                method: 'PUT',\n                headers: {\n                    Authorization: `Bearer ${localStorage.getItem('token')}`,\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(data) \n            })\n                .catch(error => console.log(error))\n            this.$emit('modified', commentId, data.text)\n            this.toggleComment(commentId)\n        }\n    },\n    /* on indique les emitters (ici l'ajout et la suppression) */\n    emits: ['created', 'deleted', 'modified']\n}\n</script>\n\n<style scoped>\n#commentsContainer {\n    margin: auto;\n    border-radius: 4px;\n    overflow-wrap: break-word;\n}\n.comment {\n    border-bottom: 1px solid rgb(0 0 0 / 10%);\n    margin: 2rem;\n    border-radius: 4px;\n}\n.header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n.commentUsername {\n    display: flex;\n    justify-content: space-between;\n    vertical-align: center;\n    width: 90%;\n    padding-left: 16px;\n}\n.commentText {\n    margin: 1rem 0 1rem 0;\n}\n.profileContainer {\n    margin: auto;\n    max-width: 48px;\n    max-height: 48px;\n    height: 48px;\n    width: 48px;\n    min-height: 48px;\n    min-width: 48px;\n    border-radius: 50%;\n    overflow: hidden;\n}\n.profile {\n    height: 100%;\n    width: 100%;\n    object-fit: cover;\n}\nform {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n}\ninput {\n    margin-top: 1.8rem;\n    width: 100%;\n    padding: 10px;\n    box-shadow: 2px 2px 8px 5px rgb(0 0 0 / 10%);\n    border-style: none;\n    border-radius: 4px;\n    outline: none;\n}\n.optionsBtn {\n    display: flex;\n}\nbutton {\n    background: none;\n    border-style: none;\n    outline: none;\n    margin-left: 1rem;\n    display: flex; \n}\n.btn {\n    width: 30%;\n}\n.btn:hover {\n    box-shadow: 2px 2px 8px 5px #00000033;\n}\n.btn:active {\n    transform: scale(0.98);\n}\ni {\n    margin-right: 3px;\n}\n@media screen and (max-width: 992px) {\n    .header {\n        flex-wrap: wrap;\n        justify-content: space-around;\n        line-height: 2rem;\n    }\n    .profileContainer {\n        margin: 0;\n    }\n    .commentUsername {\n        display: flex;\n        justify-content: center;\n        width: 100%;\n        padding-left: 0;    \n    }\n    .optionsBtn {\n        width: 100%;\n        justify-content: space-between;\n    }\n    .commentText {\n        background-color: rgba(0, 0, 0, 0.05);\n        border-radius: 4px;\n        padding: 0.5rem;\n    }\n    .btn {\n        width: 100%;\n    }\n}\n</style>"],"sourceRoot":""}]}